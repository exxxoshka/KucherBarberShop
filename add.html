<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- –ù–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="firebase-config.js"></script>
    
    <style>
        body {
            background: #f8f9fa;
        }
        .form-container {
            max-width: 800px;
            margin: 30px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–ø–∏—Å—è–º</a>
            <span class="navbar-text">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏</span>
        </div>
    </nav>
    
    <div class="container">
        <div class="form-container">
            <h2 class="mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
            
            <form id="addForm" onsubmit="return false;">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">–§–ò–û –∫–ª–∏–µ–Ω—Ç–∞ *</label>
                        <input type="text" id="clientName" class="form-control" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <input type="tel" id="phone" class="form-control" required placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ *</label>
                        <input type="date" id="date" class="form-control" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">–í—Ä–µ–º—è *</label>
                        <input type="time" id="time" class="form-control" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">–£—Å–ª—É–≥–∞ *</label>
                        <select id="service" class="form-control" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                            <option value="–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞">–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞</option>
                            <option value="–ñ–µ–Ω—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞">–ñ–µ–Ω—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞</option>
                            <option value="–ë—Ä–∏—Ç—å–µ">–ë—Ä–∏—Ç—å–µ</option>
                            <option value="–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ">–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ</option>
                            <option value="–£–∫–ª–∞–¥–∫–∞">–£–∫–ª–∞–¥–∫–∞</option>
                            <option value="–°—Ç—Ä–∏–∂–∫–∞+–ë—Ä–∏—Ç—å–µ">–°—Ç—Ä–∏–∂–∫–∞+–ë—Ä–∏—Ç—å–µ</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                        <input type="number" id="price" class="form-control" required min="0" value="1000">
                    </div>
                    
                    <div class="col-12">
                        <div class="d-flex gap-3">
                            <button type="submit" class="btn btn-success" onclick="addAppointment()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <a href="dashboard.html" class="btn btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
                        </div>
                    </div>
                </div>
            </form>
            
            <div id="message" class="mt-3"></div>
        </div>
    </div>
    
    <script>
        // –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤—Ç—Ä–∞—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('date').value = tomorrow.toISOString().split('T')[0];
        
        // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 1) {
                value = '+7 (' + value.substring(1, 4) + ') ' + 
                        value.substring(4, 7) + '-' + 
                        value.substring(7, 9) + '-' + 
                        value.substring(9, 11);
            }
            e.target.value = value.substring(0, 18);
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'index.html';
            }
        });
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
        // –í add.html, —Ñ—É–Ω–∫—Ü–∏—è addAppointment()
function addAppointment() {
    const user = auth.currentUser;
    if (!user) return;
    
    const clientName = document.getElementById('clientName').value.trim();
    const phone = document.getElementById('phone').value;
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    const service = document.getElementById('service').value;
    const price = parseInt(document.getElementById('price').value);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!clientName || !phone || !date || !time || !service || !price) {
        showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'danger');
        return;
    }
    
    // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const cleanPhone = phone.replace(/\D/g, '');
    
    const appointment = {
        // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        clientName: clientName,
        phone: cleanPhone,
        appointment_date: date,
        appointment_time: time,
        service: service,
        price: price,
        
        // –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è
        type: 'admin', // –ê–¥–º–∏–Ω—Å–∫–∞—è –∑–∞–ø–∏—Å—å
        status: 'confirmed', // –°—Ä–∞–∑—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
        user_id: user.uid, // ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        created_at: new Date().toISOString(),
        source: 'admin_panel'
    };
    
    appointmentsRef.add(appointment)
        .then(() => {
            showMessage('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 1500);
        })
        .catch(error => {
            showMessage('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'danger');
        });
}
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `
                <div class="alert alert-${type}">
                    ${text}
                </div>
            `;
        }
    </script>
</body>
</html>