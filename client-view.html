<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∑–∞–ø–∏—Å–∏ | –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .search-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table th {
            background: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
        
        .badge {
            padding: 5px 10px;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border: none;
            padding: 10px 25px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(106, 17, 203, 0.3);
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #6c757d;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        @media (max-width: 768px) {
            .table-responsive {
                font-size: 14px;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container">
            <a class="navbar-brand fw-bold" href="client-view.html" style="color: #6a11cb;">
                <span>üíà</span> BarberShop
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="booking.html" style="color: #2575fc;">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω</a>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container mt-4">
        <h1 class="text-center mb-4">üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏</h1>
        
        <!-- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É -->
        <div class="search-card mb-4">
            <h4 class="mb-3">üîç –ù–∞–π—Ç–∏ –º–æ–∏ –∑–∞–ø–∏—Å–∏</h4>
            <p class="text-muted mb-3">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑—ã–≤–∞–ª–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏</p>
            
            <div class="row g-3">
                <div class="col-md-8">
                    <input type="tel" id="checkPhone" class="form-control form-control-lg" 
                           placeholder="+7 (999) 123-45-67" required>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary btn-lg w-100" onclick="loadMyAppointments()" id="searchBtn">
                        üîç –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏
                    </button>
                </div>
            </div>
            
            <div class="mt-3 text-muted small">
                <p>üìû –ü—Ä–∏–º–µ—Ä: +7 (999) 123-45-67</p>
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="myAppointments">
            <!-- –ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏ -->
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">üì≠</div>
                <h4>–ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                <p class="text-muted">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏</p>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ -->
        <div class="text-center mt-4">
            <a href="booking.html" class="btn btn-primary btn-lg">
                ‚ûï –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—É—é —É—Å–ª—É–≥—É
            </a>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>üíà BarberShop</h5>
                    <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∏–∂–∫–∏ –∏ –±—Ä–∏—Ç—å–µ</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>üìû +7 (999) 123-45-67</p>
                    <p>üìç —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyDwXOEGv2GBkeWggfhcBnfKQWnHDVeI890",
            authDomain: "barber-salon-cucher.firebaseapp.com",
            projectId: "barber-salon-cucher",
            storageBucket: "barber-salon-cucher.firebasestorage.app",
            messagingSenderId: "337468108878",
            appId: "1:337468108878:web:0fbcb5f537d891cd2ed31f"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // ===== –ú–ê–°–ö–ê –¢–ï–õ–ï–§–û–ù–ê =====
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('checkPhone');
            
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    
                    if (value.length > 1) {
                        value = '+7 (' + value.substring(1, 4) + ') ' + 
                                value.substring(4, 7) + '-' + 
                                value.substring(7, 9) + '-' + 
                                value.substring(9, 11);
                    }
                    
                    e.target.value = value.substring(0, 18);
                });
                
                // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å
                phoneInput.focus();
            }
        });
        
        // ===== –ó–ê–ì–†–£–ó–ö–ê –ó–ê–ü–ò–°–ï–ô –ö–õ–ò–ï–ù–¢–ê =====
        async function loadMyAppointments() {
    console.log('–ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π...');
    
    const phoneInput = document.getElementById('checkPhone');
    const searchBtn = document.getElementById('searchBtn');
    const container = document.getElementById('myAppointments');
    
    if (!phoneInput || !searchBtn || !container) {
        console.error('–ù–µ –Ω–∞–π–¥–µ–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç');
        return;
    }
    
    const phoneInputValue = phoneInput.value;
    const cleanPhone = phoneInputValue.replace(/\D/g, '');
    
    console.log('–í–≤–µ–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω:', phoneInputValue);
    console.log('–û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω:', cleanPhone);
    
    // –í–ê–õ–ò–î–ê–¶–ò–Ø
    if (cleanPhone.length < 11) {
        alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (11 —Ü–∏—Ñ—Ä)');
        phoneInput.focus();
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    searchBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> –ü–æ–∏—Å–∫...';
    searchBtn.disabled = true;
    
    container.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3">–ò—â–µ–º –≤–∞—à–∏ –∑–∞–ø–∏—Å–∏...</p>
        </div>
    `;
    
    try {
        console.log('–ò—â–µ–º –∑–∞–ø–∏—Å–∏ –≤ Firebase –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:', cleanPhone);
        
        // ===== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ó–ê–ü–†–û–° (–±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞) =====
        // –ü–æ–ª—É—á–∞–µ–º –í–°–ï –∑–∞–ø–∏—Å–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
        const snapshot = await db.collection('appointments').get();
        
        console.log('–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ:', snapshot.size);
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
        const filteredAppointments = [];
        
        snapshot.forEach(doc => {
            const data = doc.data();
            const docPhone = data.phone || '';
            
            // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω—ã (—É–±–∏—Ä–∞–µ–º +7 –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º 10 —Ü–∏—Ñ—Ä)
            const cleanDocPhone = docPhone.replace(/\D/g, '');
            
            if (cleanDocPhone && cleanPhone) {
                // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ü–∏—Ñ—Ä (–±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
                const phoneSuffix1 = cleanDocPhone.length >= 11 ? cleanDocPhone.substring(cleanDocPhone.length - 10) : cleanDocPhone;
                const phoneSuffix2 = cleanPhone.length >= 11 ? cleanPhone.substring(cleanPhone.length - 10) : cleanPhone;
                
                if (phoneSuffix1 === phoneSuffix2) {
                    filteredAppointments.push({
                        id: doc.id,
                        ...data
                    });
                }
            }
        });
        
        console.log('–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π:', filteredAppointments.length);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        searchBtn.innerHTML = 'üîç –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏';
        searchBtn.disabled = false;
        
        if (filteredAppointments.length === 0) {
            console.log('–ó–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h4>–ó–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4>
                    <p class="text-muted">–ü–æ –Ω–æ–º–µ—Ä—É ${phoneInputValue} –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç</p>
                    <p class="text-muted mt-2">
                        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ:<br>
                        <code>+7 (999) 123-45-67</code> –∏–ª–∏ <code>89991234567</code>
                    </p>
                    <button class="btn btn-outline-primary mt-3" onclick="showAllAppointments()">
                        üëÅ –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ
                    </button>
                </div>
            `;
            return;
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
        filteredAppointments.sort((a, b) => {
            const dateA = a.created_at ? new Date(a.created_at).getTime() : 0;
            const dateB = b.created_at ? new Date(b.created_at).getTime() : 0;
            return dateB - dateA;
        });
        
        // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        let html = `
            <div class="card">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-0">üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${filteredAppointments.length}</h5>
                        <small class="text-muted">–¢–µ–ª–µ—Ñ–æ–Ω: ${phoneInputValue}</small>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary" onclick="showAllAppointments()">
                        üëÅ –í—Å–µ –∑–∞–ø–∏—Å–∏
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>–£—Å–ª—É–≥–∞</th>
                                    <th>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ó–∞–ø–∏—Å–∞–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody>
        `;
        
        let counter = 1;
        let totalPrice = 0;
        
        filteredAppointments.forEach(appointment => {
            // –°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏
            let statusBadge = '';
            let statusText = '';
            
            switch (appointment.status) {
                case 'pending':
                    statusBadge = 'warning';
                    statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
                    break;
                case 'confirmed':
                    statusBadge = 'success';
                    statusText = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ';
                    break;
                case 'completed':
                    statusBadge = 'info';
                    statusText = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                    break;
                case 'cancelled':
                    statusBadge = 'danger';
                    statusText = '–û—Ç–º–µ–Ω–µ–Ω–æ';
                    break;
                default:
                    statusBadge = 'secondary';
                    statusText = '–ù–µ —É–∫–∞–∑–∞–Ω';
            }
            
            // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
            let createdDate = '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            if (appointment.created_at) {
                try {
                    const date = appointment.created_at.toDate ? 
                               appointment.created_at.toDate() : 
                               new Date(appointment.created_at);
                    createdDate = date.toLocaleDateString('ru-RU');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', e);
                }
            }
            
            // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
            const appointmentDate = appointment.appointment_date || appointment.date || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const appointmentTime = appointment.appointment_time || appointment.time || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            
            // –¶–µ–Ω–∞
            const price = appointment.price || 0;
            totalPrice += price;
            
            html += `
                <tr>
                    <td>${counter}</td>
                    <td><strong>${escapeHtml(appointment.service || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}</strong></td>
                    <td>${appointmentDate}</td>
                    <td>${appointmentTime}</td>
                    <td><strong>${price} ‚ÇΩ</strong></td>
                    <td>
                        <span class="badge bg-${statusBadge}">${statusText}</span>
                    </td>
                    <td>
                        <small class="text-muted">${createdDate}</small>
                    </td>
                </tr>
            `;
            
            counter++;
        });
        
        html += `
                            </tbody>
                            <tfoot>
                                <tr class="table-light">
                                    <td colspan="4" class="text-end"><strong>–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ:</strong></td>
                                    <td><strong class="text-primary">${totalPrice} ‚ÇΩ</strong></td>
                                    <td colspan="2"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <strong>üì± –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞!</strong><br>
                        –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–∏—Å–µ–π –≤ –±—É–¥—É—â–µ–º.
                    </div>
                </div>
            </div>
        `;
        
        container.innerHTML = html;
        console.log('–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∑–∞–ø–∏—Å–µ–π:', error);
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        searchBtn.innerHTML = 'üîç –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏';
        searchBtn.disabled = false;
        
        container.innerHTML = `
            <div class="alert alert-danger">
                <h5>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ</h5>
                <p><strong>${error.message}</strong></p>
                <hr>
                <p class="mb-2"><strong>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ —Ä–µ—à–µ–Ω–∏—è:</strong></p>
                <ol>
                    <li>–ù–∞–∂–º–∏—Ç–µ <a href="#" onclick="location.reload()">–æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</a></li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</li>
                    <li>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ: <code>89991234567</code></li>
                    <li>–ò–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ <button class="btn btn-sm btn-outline-primary" onclick="loadSimpleDemo()">—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</button></li>
                </ol>
            </div>
        `;
    }
}

// ===== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

// –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
async function showAllAppointments() {
    const container = document.getElementById('myAppointments');
    container.innerHTML = '<div class="text-center py-4"><div class="spinner-border"></div><p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏...</p></div>';
    
    try {
        const snapshot = await db.collection('appointments').get();
        
        if (snapshot.empty) {
            container.innerHTML = '<div class="alert alert-warning">–í –±–∞–∑–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
            return;
        }
        
        let html = `
            <div class="card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">üëÅ –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ (${snapshot.size})</h5>
                    <small>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</small>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–£—Å–ª—É–≥–∞</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–¢–∏–ø</th>
                                </tr>
                            </thead>
                            <tbody>
        `;
        
        snapshot.forEach(doc => {
            const data = doc.data();
            html += `
                <tr>
                    <td>${data.clientName || '‚Äî'}</td>
                    <td><code>${data.phone || '‚Äî'}</code></td>
                    <td>${data.service || '‚Äî'}</td>
                    <td>${data.appointment_date || '‚Äî'}</td>
                    <td><span class="badge ${data.type === 'client' ? 'bg-info' : 'bg-secondary'}">${data.type || 'admin'}</span></td>
                </tr>
            `;
        });
        
        html += `
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary mt-3" onclick="location.reload()">
                        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∏—Å–∫—É
                    </button>
                </div>
            </div>
        `;
        
        container.innerHTML = html;
        
    } catch (error) {
        container.innerHTML = `<div class="alert alert-danger">–û—à–∏–±–∫–∞: ${error.message}</div>`;
    }
}

// –ü—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ-—Ä–µ–∂–∏–º (–µ—Å–ª–∏ Firebase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
function loadSimpleDemo() {
    const phoneInput = document.getElementById('checkPhone');
    const phoneValue = phoneInput.value || '+7 (999) 123-45-67';
    
    const container = document.getElementById('myAppointments');
    
    container.innerHTML = `
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üîÑ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</h5>
                <small>Firebase –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</small>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–£—Å–ª—É–≥–∞</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞</td>
                                <td>2024-03-20</td>
                                <td>14:00</td>
                                <td>1 500 ‚ÇΩ</td>
                                <td><span class="badge bg-success">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span></td>
                            </tr>
                            <tr>
                                <td>–ë—Ä–∏—Ç—å–µ</td>
                                <td>2024-03-15</td>
                                <td>16:00</td>
                                <td>1 000 ‚ÇΩ</td>
                                <td><span class="badge bg-info">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-end"><strong>–ò—Ç–æ–≥–æ:</strong></td>
                                <td><strong>2 500 ‚ÇΩ</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="mt-3">
                    <p class="text-muted">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞: <strong>${phoneValue}</strong></p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            </div>
        </div>
    `;
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤ URL)
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –≤ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
    const urlParams = new URLSearchParams(window.location.search);
    const phoneFromUrl = urlParams.get('phone');
    
    if (phoneFromUrl) {
        document.getElementById('checkPhone').value = phoneFromUrl;
        // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º
        setTimeout(() => loadMyAppointments(), 500);
    }
    
    // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const phoneInput = document.getElementById('checkPhone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 1) {
                value = '+7 (' + value.substring(1, 4) + ') ' + 
                        value.substring(4, 7) + '-' + 
                        value.substring(7, 9) + '-' + 
                        value.substring(9, 11);
            }
            e.target.value = value.substring(0, 18);
        });
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        phoneInput.focus();
        
        // –ü–æ–∏—Å–∫ –ø–æ Enter
        phoneInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadMyAppointments();
            }
        });
    }
});
        
        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('checkPhone');
            
            if (phoneInput) {
                phoneInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loadMyAppointments();
                    }
                });
            }
        });
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        function addDemoAppointments() {
            // –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
            const demoData = {
                clientName: "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
                phone: "79991234567",
                service: "–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
                price: 1500,
                appointment_date: "2024-03-20",
                appointment_time: "14:00",
                status: "confirmed",
                type: "client",
                created_at: new Date().toISOString()
            };
            
            // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
            // db.collection('appointments').add(demoData)
            //     .then(() => console.log('–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞'))
            //     .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
        // addDemoAppointments();
    </script>
    <script>
    // –ì–æ—Ä—è—á–∞—è –∫–ª–∞–≤–∏—à–∞ Alt + J –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    document.addEventListener('keydown', function(event) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Alt + J –∏–ª–∏ Alt + –ô (—Ä—É—Å—Å–∫–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞)
        if (event.altKey && (event.key === 'j' || event.key === 'J' || event.key === '–π' || event.key === '–ô')) {
            event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showKeyboardNotification('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å...');
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ index.html —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 500);
        }
        
        // Alt + B –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ booking.html (–∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞)
        if (event.altKey && (event.key === 'b' || event.key === 'B' || event.key === '–∏' || event.key === '–ò')) {
            event.preventDefault();
            showKeyboardNotification('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏...');
            setTimeout(() => {
                window.location.href = 'booking.html';
            }, 500);
        }
        
        // Alt + C –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ client-view.html (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π)
        if (event.altKey && (event.key === 'c' || event.key === 'C' || event.key === '—Å' || event.key === '–°')) {
            event.preventDefault();
            showKeyboardNotification('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–ø–∏—Å–µ–π...');
            setTimeout(() => {
                window.location.href = 'client-view.html';
            }, 500);
        }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showKeyboardNotification(message) {
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
        const oldNotification = document.getElementById('keyboard-notification');
        if (oldNotification) {
            oldNotification.remove();
        }
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notification = document.createElement('div');
        notification.id = 'keyboard-notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 9999;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-in 1.7s forwards;
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.2em;">üöÄ</span>
                <span>${message}</span>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes fadeOut {
                from {
                    opacity: 1;
                }
                to {
                    opacity: 0;
                }
            }
        `;
        
        document.head.appendChild(style);
        document.body.appendChild(notification);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 2000);
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à–∞—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        setTimeout(() => {
            showKeyboardHint();
        }, 2000);
    });
    
    function showKeyboardHint() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ª–∏ —É–∂–µ –ø–æ–¥—Å–∫–∞–∑–∫—É
        if (localStorage.getItem('keyboardHintShown')) return;
        
        const hint = document.createElement('div');
        hint.id = 'keyboard-hint';
        hint.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 9998;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: slideUp 0.5s ease-out;
        `;
        
        hint.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong style="color: #6a11cb;">üéÆ –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</strong>
                <button onclick="closeHint()" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">√ó</button>
            </div>
            <div style="font-size: 0.9em;">
                <div><kbd style="background: #6a11cb; color: white; padding: 2px 6px; border-radius: 4px;">Alt</kbd> + <kbd style="background: #2575fc; color: white; padding: 2px 6px; border-radius: 4px;">J</kbd> ‚Üí –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                <div><kbd style="background: #6a11cb; color: white; padding: 2px 6px; border-radius: 4px;">Alt</kbd> + <kbd style="background: #28a745; color: white; padding: 2px 6px; border-radius: 4px;">B</kbd> ‚Üí –ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</div>
                <div><kbd style="background: #6a11cb; color: white; padding: 2px 6px; border-radius: 4px;">Alt</kbd> + <kbd style="background: #20c997; color: white; padding: 2px 6px; border-radius: 4px;">C</kbd> ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π</div>
            </div>
            <div style="margin-top: 10px; font-size: 0.8em; color: #aaa;">
                –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            </div>
        `;
        
        document.body.appendChild(hint);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage —á—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–∫–∞–∑–∞–ª–∏
        localStorage.setItem('keyboardHintShown', 'true');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (hint.parentElement) {
                hint.remove();
            }
        }, 10000);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
    window.closeHint = function() {
        const hint = document.getElementById('keyboard-hint');
        if (hint && hint.parentElement) {
            hint.remove();
        }
    };
    
    // –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    const hintStyle = document.createElement('style');
    hintStyle.textContent = `
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        kbd {
            font-family: monospace;
            margin: 0 2px;
        }
    `;
    document.head.appendChild(hintStyle);
</script>
</body>
</html>